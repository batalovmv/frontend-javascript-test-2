name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # –î–µ–ø–ª–æ–π –ø—Ä–∏ –ø—É—à–µ –≤ main

permissions:
  contents: write  # –†–∞–∑—Ä–µ—à–∞–µ–º Actions –ø—É—à–∏—Ç—å —Ñ–∞–π–ª—ã

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: üöÄ Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v3

      - name: üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
        uses: docker/setup-buildx-action@v2

      - name: üèóÔ∏è –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ (–ø—É—Ç—å –∫ `Dockerfile` –≤ `my-app/`)
        run: docker build -t my-vite-app -f my-app/Dockerfile my-app/

      - name: üì¶ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `dist/` –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—É—á—ë—Ç `my-app/`)
        run: |
          CONTAINER_ID=$(docker create my-vite-app)  # –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
          docker cp $CONTAINER_ID:/app/react-app/dist ./my-app/dist  # –ö–æ–ø–∏—Ä—É–µ–º dist/
          docker rm -v $CONTAINER_ID  # –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

      - name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages  # –í–µ—Ç–∫–∞ Pages
          folder: my-app/dist  # –ü–∞–ø–∫–∞ —Å –≥–æ—Ç–æ–≤—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏